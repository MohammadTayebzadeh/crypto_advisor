import json
import requests
from ai import ai


def crypto(symbol):
    newsget = requests.get(
        f'https://news-headlines.tradingview.com/v2/view/headlines/symbol?client=landing&lang=en&section=&streaming=true&symbol=CRYPTO%3A{symbol}')

    newsresult = newsget.json()

    prompt = f"""
    لطفاً خبرهای زیر را تحلیل کنید و نتایج را در قالب یک جدول و یک تحلیل نهایی ارائه دهید. به این ترتیب عمل کنید:

    ###: تحلیل خبرها
    - برای هر خبر:
    1. عنوان خبر را به فارسی ترجمه کنید.
    2. مشخص کنید که خبر مثبت است یا منفی.
    3. لینک خبر را در جدول درج کنید.

    ###: تحلیل کلی
    - شرایط کلی فاندامنتال بازار را با امتیازی بین 0 تا 100 ارزیابی کنید:
    - 0: بدترین شرایط ممکن
    - 100: بهترین شرایط ممکن
    - بر اساس تحلیل، یکی از گزینه‌های زیر را پیشنهاد دهید: "بخر"، "بفروش".

    ### خروجی مورد انتظار:
    1. **جدول خبرها**: شامل ستون‌های زیر:
    - **عنوان خبر (فارسی)**: ترجمه عنوان.
    - **لینک خبر**: لینک مربوطه.
    - **تحلیل مثبت/منفی بودن خبر**: آیا خبر برای بازار مثبت است یا منفی؟
    2. **تحلیل کلی و پیشنهاد**: 
    - پیشنهاد: بخر، بفروش.
    - دلایل: چرا این پیشنهاد داده شد؟
    - شاخص فاندامنتالی: امتیاز 0 تا 100.

    ### خبرها:
    {json.dumps(newsresult)}
    """

    ai(prompt)

import json
import requests
from ai import ai


def crypto(symbol):
    newsget = requests.get(
        f'https://news-headlines.tradingview.com/v2/view/headlines/symbol?client=landing&lang=en&section=&streaming=true&symbol=CRYPTO%3A{symbol}')

    newsresult = newsget.json()

    prompt = f"""
    لطفاً خبرهای زیر را تحلیل کنید و نتایج را در قالب یک جدول و تحلیل نهایی ارائه دهید. برای هر خبر و تحلیل کلی به موارد زیر توجه کنید:

    ### تحلیل خبرها:
    برای هر خبر:
    1. عنوان خبر را به فارسی ترجمه کنید.
    2. ارزیابی کنید که این خبر برای بازار مثبت است یا منفی و دلایل آن را ذکر کنید.
    3. لینک خبر را در جدول درج کنید.
    4. اگر ممکن است، جزئیات بیشتری در مورد تاثیرات این خبر بر بازار ارائه دهید.

    ### تحلیل کلی:
    1. شرایط کلی فاندامنتال بازار را با امتیازی بین 0 تا 100 ارزیابی کنید:
    - 0: بدترین شرایط ممکن
    - 100: بهترین شرایط ممکن
    2. به صورت دقیق، دلایل این ارزیابی را بیان کنید (عوامل اقتصادی، سیاسی و اجتماعی تاثیرگذار).
    3. اگر تحلیل شما به یک پیش‌بینی خاص منتهی می‌شود، آن را با دلایل ارائه دهید.

    ### خروجی مورد انتظار:
    1. **جدول خبرها**: شامل ستون‌های زیر:
    - **عنوان خبر (فارسی)**: ترجمه عنوان.
    - **لینک خبر**: لینک مربوطه.
    - **تحلیل مثبت/منفی بودن خبر**: ارزیابی مثبت یا منفی بودن خبر و دلایل آن.
    2. **تحلیل کلی و پیشنهاد**: 
    - شاخص فاندامنتالی: امتیاز 0 تا 100 و دلایل این ارزیابی.
    - پیش‌بینی بازار: پیش‌بینی کوتاه‌مدت بر اساس تحلیل‌ها و اخبار.

    ### خبرها:
    {json.dumps(newsresult)}
    """


    ai(prompt)
